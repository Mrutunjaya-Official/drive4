<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Notes App Standalone</title>
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet" />
<style>
  :root {
    --white: #fff;
    --black: #000;
    --gray-light: #f5f5f7;
    --gray-medium: #a4a4a4;
    --gray-dark: #232323;
    --blue: #007aff;
    --blue-dark: #0051a8;
    --font-stack: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen,
      Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", sans-serif;
    --nav-height: 50px;
    --transition-speed: 0.3s;
    --border-radius: 16px;
    --menu-bg-light: #e6f0ff;
    --menu-bg-dark: #003366;
  }
  *, *::before, *::after { box-sizing: border-box; }
  html, body {
    margin: 0; padding: 0; height: 100%;
    font-family: var(--font-stack);
    background: var(--gray-light);
    color: var(--gray-dark);
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    overflow-x: hidden;
    transition: background-color 0.3s, color 0.3s;
    user-select: none;
  }
  body.dark-mode {
    background: #121212;
    color: var(--gray-light);
  }
  a { color: var(--blue); text-decoration: none; cursor: pointer; transition: color var(--transition-speed); user-select:none;}
  a:hover, a:focus {color: var(--blue-dark); outline: none;}
  header {
    position: fixed; top: 0; left: 0; right: 0; height: var(--nav-height);
    background: var(--white); box-shadow: 0 2px 6px rgb(0 0 0 / 0.1);
    display: flex; align-items: center; justify-content: center;
    padding: 0 16px; z-index: 1010; user-select:none;
    transition: background-color 0.3s, color 0.3s;
  }
  body.dark-mode header { background: #1c1c1e; box-shadow: 0 2px 6px #000a; }
  .logo-container {
    display: flex; align-items: center; color: var(--blue);
    font-weight: 700; font-size: 1.6rem; gap: 8px;
    cursor: pointer; user-select: none; transition: color 0.3s;
  }
  body.dark-mode .logo-container { color: var(--gray-light); }
  .logo-container .material-symbols-outlined { font-size: 30px; }
  .logo-container:hover, .logo-container:focus {color: var(--blue-dark); outline: none;}
  main {
    margin: calc(var(--nav-height) + 20px) 16px 90px 16px;
    background: var(--white); border-radius: var(--border-radius);
    padding: 24px 20px 64px; min-height: calc(100vh - calc(var(--nav-height) + 190px));
    overflow-y: auto; user-select:text; transition: background-color 0.3s, color 0.3s;
  }
  body.dark-mode main { background: #222; color: var(--gray-light); }
  .note-section { margin-bottom: 40px; }
  .note-section h3 {
    margin-bottom: 16px; font-weight: 700; font-size: 1.8rem;
    color: var(--blue-dark); border-bottom: 3px solid var(--blue);
    padding-bottom: 6px; user-select:none;
  }
  body.dark-mode .note-section h3 {
    color: var(--blue); border-color: rgba(0,85,179,0.9);
  }
  .section-notes-list { list-style: none; padding: 0; margin: 0; }
  .section-notes-list li {
    display: flex; align-items: center; gap: 8px;
    padding: 12px 16px; border-radius: var(--border-radius);
    font-weight: 600; font-size: 1.25rem;
    color: var(--gray-dark); cursor: pointer;
    transition: background-color 0.3s; user-select:none;
  }
  body.dark-mode .section-notes-list li { color: var(--gray-light); }
  .section-notes-list li:hover, .section-notes-list li:focus-within {
    background: var(--menu-bg-light); outline: none;
  }
  body.dark-mode .section-notes-list li:hover, .body.dark-mode .section-notes-list li:focus-within {background:#333;}
  .section-notes-list li a {
    color: inherit; outline: none; display: block; flex-grow: 1;
  }
  .letter-box {
    display: flex; align-items: center; justify-content: center;
    width: 42px; height: 42px; min-width: 42px;
    background: var(--blue); border-radius: 12px;
    color: var(--white); font-weight: 700; font-size: 1.2rem;
    user-select: none;
  }
  body.dark-mode .letter-box { background: var(--blue-dark); }
  .numbering {
    font-weight: 700; font-size: 1.1rem; width: 30px;
    display: flex; justify-content: center; user-select:none;
    color: var(--blue);
  }
  body.dark-mode .numbering { color: var(--blue); }
  #download-page {
    display: none; user-select:none; text-align: center;
  }
  #download-page h2 {
    font-size: 2rem; font-weight: 800; color: var(--blue-dark);
    margin-bottom: 22px; user-select:none;
  }
  body.dark-mode #download-page h2 { color: var(--blue); }
  #download-page p {
    font-size: 1.1rem; color: var(--gray-dark); margin-bottom: 12px;
  }
  body.dark-mode #download-page p { color: var(--gray-light); }
  #download-progress-info {
    font-weight: 600; font-size: 1rem; color: var(--gray-medium);
    margin-top: 12px; min-height: 1.3em;
  }
  body.dark-mode #download-progress-info { color: var(--gray-light); }
  #download-actions {
    display: flex; justify-content: center; align-items: center; gap: 12px; margin-top: 12px;
  }
  .icon-button {
    background: var(--blue); border: none; border-radius: 30px;
    width: 56px; height: 56px; cursor: pointer; display: flex;
    align-items: center; justify-content: center; color: white;
    font-size: 28px; transition: background-color 0.3s ease, color 0.3s ease;
  }
  .icon-button:disabled {
    background: var(--gray-medium); cursor: not-allowed; color: var(--gray-light);
  }
  .icon-button:not(:disabled):hover,
  .icon-button:not(:disabled):focus {
    background: var(--blue-dark); outline: none;
  }
  #favorite-btn.active {
    color: #f44336;
    background-color: rgba(244, 67, 54, 0.15);
  }
  #settings-page, #info-page {
    display: none; max-width: 700px; margin: 0 auto 80px; padding: 20px; text-align: left;
  }
  #settings-page h2, #info-page h2 {
    font-size: 1.8rem; margin-bottom: 20px; color: var(--blue-dark);
  }
  body.dark-mode #settings-page h2, body.dark-mode #info-page h2 { color: var(--blue); }
  #settings-page label {
    font-size: 1.1rem; cursor: pointer;
  }
  #settings-page input[type="checkbox"] {
    margin-right: 8px; transform: scale(1.2); cursor: pointer;
  }
  #settings-page .setting-option { margin-bottom: 20px; }
  #info-page p {
    font-size: 1.1rem; line-height: 1.5;
  }
  .info-section {
    margin-top: 20px;
  }
  .info-section h3 {
    font-size: 1.4rem; margin-bottom: 8px;
  }
  .info-list {
    list-style: disc inside; margin: 0 0 20px 0; padding-left: 0;
  }
  .info-list li { margin-bottom: 6px; }
  #bottom-nav-container {
    position: fixed; bottom: 0; left: 0; right: 0;
    background: var(--white); border-top: 1px solid #ccc;
    box-shadow: 0 -1px 4px rgba(0,0,0,0.07);
    display: flex; align-items: center; height: var(--nav-height);
    padding: 0 12px; gap: 10px; z-index: 1100; user-select:none;
  }
  body.dark-mode #bottom-nav-container {
    background: #1c1c1e; border-color: #333; box-shadow: 0 -1px 6px #000a;
  }
  nav#site-nav {
    background: var(--menu-bg-light); border-radius: var(--border-radius);
    padding: 8px 12px; display: flex; gap: 12px;
    max-width: 100%; height: 44px; flex-shrink: 1; flex-grow: 1;
    overflow-x: auto; scrollbar-width: thin; scrollbar-color: var(--blue) var(--gray-light);
  }
  nav#site-nav::-webkit-scrollbar {
    height: 6px;
  }
  nav#site-nav::-webkit-scrollbar-track {
    background: var(--gray-light);
    border-radius: 3px;
  }
  nav#site-nav::-webkit-scrollbar-thumb {
    background-color: var(--blue);
    border-radius: 3px;
  }
  body.dark-mode nav#site-nav {
    background: rgba(40, 61, 102, 0.48);
  }
  nav#site-nav a {
    white-space: nowrap; font-size: 1.1rem; height: 36px; line-height: 36px;
    color: var(--blue); padding: 0 12px; border-radius: var(--border-radius);
    display: flex; align-items: center; cursor: pointer; font-weight: 600;
    text-transform: uppercase; transition: background-color 0.3s, color 0.3s;
    gap: 4px;
  }
  nav#site-nav a span.material-symbols-outlined { font-size: 22px; }
  nav#site-nav a.active,
  nav#site-nav a:hover,
  nav#site-nav a:focus {
    background-color: var(--blue); color: var(--white); outline: none;
  }
  body.dark-mode nav#site-nav a.active,
  body.dark-mode nav#site-nav a:hover,
  body.dark-mode nav#site-nav a:focus {
    background-color: var(--blue-dark); color: white;
  }
  #bottom-icons {
    display: flex; align-items: center; gap: 12px; flex-shrink: 0;
  }
  #bottom-icons button.icon-btn {
    background: transparent; border: none; cursor: pointer;
    color: var(--blue); font-size: 26px; padding: 6px; border-radius: 10px;
    transition: background-color 0.3s, color 0.3s;
  }
  body.dark-mode #bottom-icons button.icon-btn {
    color: var(--gray-light);
  }
  #bottom-icons button.icon-btn:hover,
  #bottom-icons button.icon-btn:focus {
    background-color: rgba(0, 122, 255, 0.25);
    color: var(--white);
    outline: none;
  }
  body.dark-mode #bottom-icons button.icon-btn:hover,
  body.dark-mode #bottom-icons button.icon-btn:focus {
    background-color: rgba(0, 85, 179, 0.5);
    color: var(--white);
  }
  a:focus-visible,
  button:focus-visible {
    outline: 2px solid var(--blue); outline-offset: 4px;
  }
  @media (max-width: 720px){
    main { margin: calc(var(--nav-height)+20px) 12px 140px; }
    #bottom-nav-container {
      padding: 0 12px; gap: 6px; justify-content: space-between; flex-wrap: nowrap;
    }
    nav#site-nav {
      padding: 6px 8px; height: 40px; margin-bottom: 0; justify-content: center;
      gap: 8px; max-width: calc(100% - 100px);
    }
    nav#site-nav a {
      font-size: 0; flex-direction: column; align-items: center; white-space: nowrap;
    }
    nav#site-nav a span.material-symbols-outlined {
      font-size: 24px; user-select:none;
    }
    nav#site-nav a > span:last-child { display: none; }
    #bottom-icons {
      display: none; position: fixed; bottom: 56px; right: 12px;
      background: rgba(255 255 255 / 0.85); backdrop-filter: blur(10px);
      border-radius: 16px; padding: 8px 12px; gap: 12px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.15); z-index: 1200;
      transition: opacity 0.3s ease, visibility 0.3s ease; user-select:none;
    }
    body.dark-mode #bottom-icons {
      background: rgba(28 28 30 / 0.85); box-shadow: 0 4px 10px rgba(0,0,0,0.6);
    }
    #bottom-icons.show { display: flex; }
    #bottom-icons button.icon-btn { font-size: 24px; padding: 6px; }
    #icons-toggle-btn {
      display: block; background: transparent; border: none; cursor: pointer;
      color: var(--blue); font-size: 32px; padding: 6px 8px;
      border-radius: 14px; user-select: none;
      transition: background-color 0.3s, color 0.3s;
      flex-shrink: 0; align-self: center; z-index: 1210; position: relative;
      margin-left: 8px;
    }
    body.dark-mode #icons-toggle-btn { color: var(--gray-light); }
    #icons-toggle-btn:hover,
    #icons-toggle-btn:focus {
      background-color: rgba(0, 122, 255, 0.25); color: var(--white); outline: none;
    }
  }
  @media (min-width: 721px) { #icons-toggle-btn { display: none; } }
</style>
</head>
<body>
<header>
  <div class="logo-container" tabindex="0" role="button" aria-label="Home" title="Home">
    <span class="material-symbols-outlined" aria-hidden="true">aodglyphsarchitecture</span>
  </div>
</header>
<main>
  <section id="content-page" aria-label="Notes Content"></section>

  <section id="download-page" aria-live="polite" aria-atomic="true" style="display:none; text-align:center; padding: 0 20px;">
    <h2 id="note-title"></h2>
    <p id="note-description">Tap the button below to download the note.</p>
    <div id="download-actions" style="margin-top: 12px; display: flex; justify-content: center; align-items: center; gap: 12px;">
      <button id="download-btn" class="icon-button" disabled aria-label="Download PDF" aria-live="polite" aria-busy="false" title="Download PDF" type="button">
        <span class="material-symbols-outlined" aria-hidden="true">download</span>
      </button>
      <button id="favorite-btn" class="icon-button" aria-label="Add to favorites" title="Add/Remove Favorite" type="button">
        <span class="material-symbols-outlined" aria-hidden="true">favorite_border</span>
      </button>
      <button id="back-btn" class="icon-button" aria-label="Back to notes list" title="Back to Notes" type="button">
        <span class="material-symbols-outlined" aria-hidden="true">arrow_back</span>
      </button>
      <button id="report-btn" class="icon-button" aria-label="Report issue" title="Report" type="button">
        <span class="material-symbols-outlined" aria-hidden="true">report</span>
      </button>
      <button id="feedback-btn" class="icon-button" aria-label="Send feedback" title="Feedback" type="button">
        <span class="material-symbols-outlined" aria-hidden="true">feedback</span>
      </button>
    </div>
    <div id="progress-bar-container" aria-hidden="true" style="position:relative; margin-top: 20px;">
      <div id="progress-bar"></div>
      <div id="progress-text" aria-live="off" aria-atomic="true" style="position: absolute; right: 14px; top: 50%; transform: translateY(-50%); font-weight:700; color: var(--gray-dark); user-select:none;">0%</div>
    </div>
    <div id="download-progress-info"></div>

    <div class="extra-materials" aria-label="More Added Materials">
      <h3>More Added Materials</h3>
      <ul id="more-materials-list"></ul>
    </div>

    <div class="related-topics" aria-label="Related Topics">
      <h3>Related Topics</h3>
      <ul id="related-topics-list"></ul>
    </div>
  </section>

  <section id="settings-page" role="region" aria-label="Settings Page" style="display:none;">
    <h2>Settings</h2>
    <div class="setting-option">
      <label>
        <input type="checkbox" id="dark-mode-toggle" />
        Enable Dark Mode
      </label>
    </div>
    <div class="setting-option">
      <label>
        <input type="checkbox" id="example-setting" />
        Sample Setting Option (no effect)
      </label>
    </div>
    <div class="setting-option">
      <label for="font-size-select">Font Size:</label><br/>
      <select id="font-size-select" style="margin-top: 6px;">
        <option value="small">Small</option>
        <option value="medium" selected>Medium</option>
        <option value="large">Large</option>
      </select>
    </div>
  </section>

  <section id="info-page" role="region" aria-label="Information Page" style="display:none;">
    <h2>About This App</h2>
    <p>This Notes application allows you to browse, download, and manage notes and materials efficiently.</p>
    <p>Features include light/dark theme switching, topic and notes listing with rich visual cues, and a convenient mobile-friendly navigation.</p>
    <p>Developed with accessibility and user experience in mind.</p>
    <button id="clear-info-btn" type="button" style="margin-top:10px; padding:8px 16px; border:none; background: var(--blue); color:#fff; border-radius: 8px; cursor:pointer;">Clear All Info</button>
    <div class="info-section" aria-label="Recent Activity">
      <h3>Recent Activity</h3>
      <ul class="info-list" id="recent-activity-list">
        <li>No recent activity.</li>
      </ul>
    </div>
    <div class="info-section" aria-label="Downloads">
      <h3>Downloads</h3>
      <ul class="info-list" id="downloads-list">
        <li>No recent downloads.</li>
      </ul>
    </div>
    <div class="info-section" aria-label="Notifications">
      <h3>Notifications</h3>
      <ul class="info-list" id="notifications-list">
        <li>No new notifications.</li>
      </ul>
    </div>
  </section>

</main>

<div id="bottom-nav-container" aria-label="Bottom navigation and actions">
  <nav id="site-nav" role="navigation" aria-label="Site Navigation">
    <a href="#" id="nav-home" class="active" role="link" tabindex="0" aria-current="page">
      <span class="material-symbols-outlined" aria-hidden="true">home</span>
      <span>Home</span>
    </a>
    <a href="#" id="nav-notes" role="link" tabindex="0">
      <span class="material-symbols-outlined" aria-hidden="true">note</span>
      <span>Notes</span>
    </a>
    <a href="#" id="nav-download" role="link" tabindex="0">
      <span class="material-symbols-outlined" aria-hidden="true">download</span>
      <span>Downloaded</span>
    </a>
    <a href="#" id="nav-settings" role="link" tabindex="0">
      <span class="material-symbols-outlined" aria-hidden="true">settings</span>
      <span>Settings</span>
    </a>
    <a href="#" id="nav-info" role="link" tabindex="0">
      <span class="material-symbols-outlined" aria-hidden="true">info</span>
      <span>Info</span>
    </a>
  </nav>
  <button id="icons-toggle-btn" class="icon-btn" aria-label="Toggle bottom icons visibility" title="Show/Hide icons" tabindex="0">
    <span class="material-symbols-outlined" aria-hidden="true">blur_on</span>
  </button>
  <div id="bottom-icons" aria-label="Bottom action icons">
    <button id="theme-toggle" class="icon-btn" aria-label="Toggle light/dark theme" title="Toggle theme" tabindex="0">
      <span class="material-symbols-outlined" aria-hidden="true">light_mode</span>
    </button>
    <button id="favorites-nav-btn" class="icon-btn" aria-label="View Favorites" title="Favorites" tabindex="0">
      <span class="material-symbols-outlined" aria-hidden="true">favorite</span>
    </button>
    <button class="icon-btn" aria-label="User Profile" title="User Profile" tabindex="0">
      <span class="material-symbols-outlined" aria-hidden="true">person</span>
    </button>
  </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", () => {
  let notesDataCache = {
    "sections": [
      {
        "name": "Mathematics",
        "notes": [
          {
            "title": "Algebra Basics",
            "description": "Introduction to algebraic expressions and equations",
            "pdfLink": "https://example.com/algebra-basics.pdf",
            "extraMaterials": [
              { "title": "Algebra Exercises", "url": "https://example.com/exercises" }
            ],
            "relatedTopics": [
              { "title": "Geometry", "url": "https://example.com/geometry" }
            ]
          },
          {
            "title": "Calculus Intro",
            "description": "Basic calculus concepts",
            "pdfLink": "https://example.com/calculus-intro.pdf",
            "extraMaterials": [],
            "relatedTopics": []
          }
        ]
      },
      {
        "name": "Physics",
        "notes": [
          {
            "title": "Classical Mechanics",
            "description": "Basics of motions and forces",
            "pdfLink": "https://example.com/classical-mechanics.pdf",
            "extraMaterials": [],
            "relatedTopics": []
          }
        ]
      }
    ]
  };
  let downloadInterval = null;
  let favorites = JSON.parse(localStorage.getItem('favorites') || "[]");
  let recentActivity = JSON.parse(localStorage.getItem('recentActivity') || "[]");
  let recentDownloads = JSON.parse(localStorage.getItem('recentDownloads') || "[]");
  let notifications = JSON.parse(localStorage.getItem('notifications') || "[]");
  let currentNote = null;

  const contentPage = document.getElementById("content-page");
  const downloadPage = document.getElementById("download-page");
  const settingsPage = document.getElementById("settings-page");
  const infoPage = document.getElementById("info-page");
  const noteTitleElem = document.getElementById("note-title");
  const noteDescElem = document.getElementById("note-description");
  const downloadBtn = document.getElementById("download-btn");
  const favoriteBtn = document.getElementById("favorite-btn");
  const backBtn = document.getElementById("back-btn");
  const reportBtn = document.getElementById("report-btn");
  const feedbackBtn = document.getElementById("feedback-btn");
  const progressBarContainer = document.getElementById("progress-bar-container");
  const progressBar = document.getElementById("progress-bar");
  const progressText = document.getElementById("progress-text");
  const downloadProgressInfo = document.getElementById("download-progress-info");
  const themeToggleBtn = document.getElementById("theme-toggle");
  const favoritesNavBtn = document.getElementById("favorites-nav-btn");
  const navHomeLink = document.getElementById("nav-home");
  const navNotesLink = document.getElementById("nav-notes");
  const navDownloadLink = document.getElementById("nav-download");
  const navSettingsLink = document.getElementById("nav-settings");
  const navInfoLink = document.getElementById("nav-info");
  const topNavLinks = [navHomeLink, navNotesLink, navDownloadLink, navSettingsLink, navInfoLink];
  const iconsToggleBtn = document.getElementById("icons-toggle-btn");
  const bottomIcons = document.getElementById("bottom-icons");
  const moreMaterialsList = document.getElementById("more-materials-list");
  const relatedTopicsList = document.getElementById("related-topics-list");
  const darkModeToggleCheckbox = document.getElementById("dark-mode-toggle");
  const fontSizeSelect = document.getElementById("font-size-select");
  const exampleSettingCheckbox = document.getElementById("example-setting");
  const recentActivityList = document.getElementById("recent-activity-list");
  const downloadsList = document.getElementById("downloads-list");
  const notificationsList = document.getElementById("notifications-list");
  const clearInfoBtn = document.getElementById("clear-info-btn");

  function createLetterBox(text) {
    const box = document.createElement("div");
    box.className = "letter-box";
    box.textContent = text.toUpperCase();
    return box;
  }
  function createNumbering(number) {
    const numEl = document.createElement("div");
    numEl.className = "numbering";
    numEl.textContent = number + ".";
    return numEl;
  }
  function hideAllPages() {
    contentPage.style.display = "none";
    downloadPage.style.display = "none";
    settingsPage.style.display = "none";
    infoPage.style.display = "none";
  }

  function isFavorite(note) { return favorites.some(fav => fav.title === note.title); }
  function saveFavorites() { localStorage.setItem('favorites', JSON.stringify(favorites)); }
  function toggleFavorite(note) {
    if(isFavorite(note)) favorites = favorites.filter(fav => fav.title !== note.title);
    else favorites.push(note);
    saveFavorites();
  }
  function updateFavoriteBtn(note) {
    if(isFavorite(note)) {
      favoriteBtn.classList.add("active");
      favoriteBtn.title = "Remove from Favorites";
      favoriteBtn.firstElementChild.textContent = "favorite";
    } else {
      favoriteBtn.classList.remove("active");
      favoriteBtn.title = "Add to Favorites";
      favoriteBtn.firstElementChild.textContent = "favorite_border";
    }
  }

  function addRecentActivity(text) {
    recentActivity.push(`${new Date().toLocaleString()}: ${text}`);
    if (recentActivity.length > 30) recentActivity.shift();
    localStorage.setItem('recentActivity', JSON.stringify(recentActivity));
  }
  function addRecentDownload(title) {
    recentDownloads.push(`${new Date().toLocaleString()}: ${title}`);
    if (recentDownloads.length > 30) recentDownloads.shift();
    localStorage.setItem('recentDownloads', JSON.stringify(recentDownloads));
  }
  function addNotification(text) {
    notifications.push(`${new Date().toLocaleString()}: ${text}`);
    if (notifications.length > 30) notifications.shift();
    localStorage.setItem('notifications', JSON.stringify(notifications));
  }
  function renderRecentActivity() {
    recentActivityList.innerHTML = '';
    if (recentActivity.length === 0) {
      const li = document.createElement('li');
      li.textContent = "No recent activity.";
      recentActivityList.appendChild(li);
      return;
    }
    recentActivity.slice(-10).reverse().forEach(item => {
      const li = document.createElement('li');
      li.textContent = item;
      recentActivityList.appendChild(li);
    });
  }
  function renderDownloads() {
    downloadsList.innerHTML = '';
    if (recentDownloads.length === 0) {
      const li = document.createElement('li');
      li.textContent = "No recent downloads.";
      downloadsList.appendChild(li);
      return;
    }
    recentDownloads.slice(-10).reverse().forEach(title => {
      const li = document.createElement('li');
      li.textContent = title;
      downloadsList.appendChild(li);
    });
  }
  function renderNotifications() {
    notificationsList.innerHTML = '';
    if (notifications.length === 0) {
      const li = document.createElement('li');
      li.textContent = "No new notifications.";
      notificationsList.appendChild(li);
      return;
    }
    notifications.slice(-10).reverse().forEach(note => {
      const li = document.createElement('li');
      li.textContent = note;
      notificationsList.appendChild(li);
    });
  }

  function showBooksList() {
    hideAllPages();
    if (!notesDataCache) return;
    contentPage.innerHTML = "";
    const ul = document.createElement("ul");
    ul.className = "section-notes-list";
    notesDataCache.sections.forEach((section, index) => {
      const li = document.createElement("li");
      const numbering = createNumbering(index + 1);
      const letterBox = createLetterBox(section.name.slice(0,2));
      const textSpan = document.createElement("span");
      textSpan.textContent = section.name;
      textSpan.style.flexGrow = "1";
      li.appendChild(numbering);
      li.appendChild(letterBox);
      li.appendChild(textSpan);
      li.style.cursor = "pointer";
      li.tabIndex = 0;
      li.addEventListener("click", () => {
        showNotesOfBook(section);
        setActiveTopTab(navNotesLink);
        addRecentActivity(\`Viewed section: \${section.name}\`);
      });
      li.addEventListener("keydown", e => {
        if(e.key==="Enter" || e.key===" ") {
          e.preventDefault();
          showNotesOfBook(section);
          setActiveTopTab(navNotesLink);
          addRecentActivity(\`Viewed section: \${section.name}\`);
        }
      });
      ul.appendChild(li);
    });
    contentPage.appendChild(ul);
    contentPage.style.display = "";
  }

  function showNotesOfBook(section) {
    hideAllPages();
    contentPage.innerHTML = "";
    const sectionEl = document.createElement("section");
    sectionEl.className = "note-section";
    const heading = document.createElement("h3");
    heading.textContent = section.name;
    sectionEl.appendChild(heading);
    const ul = document.createElement("ul");
    ul.className = "section-notes-list";
    section.notes.forEach((note, index) => {
      const li = document.createElement("li");
      const numbering = createNumbering(index + 1);
      const letterBox = createLetterBox(note.title.slice(0,2));
      const a = document.createElement("a");
      a.href = "#";
      a.textContent = note.title;
      a.tabIndex = 0;
      li.appendChild(numbering);
      li.appendChild(letterBox);
      li.appendChild(a);
      a.addEventListener("click", e => {
        e.preventDefault();
        openDownloadPage(note);
        addRecentActivity(\`Opened note: \${note.title}\`);
      });
      a.addEventListener("keydown", e => {
        if (e.key === "Enter" || e.key === " ") {
          e.preventDefault();
          openDownloadPage(note);
          addRecentActivity(\`Opened note: \${note.title}\`);
        }
      });
      ul.appendChild(li);
    });
    sectionEl.appendChild(ul);
    contentPage.appendChild(sectionEl);
    contentPage.style.display = "";
  }

  function showAllNotes() {
    hideAllPages();
    if(!notesDataCache) return;
    contentPage.innerHTML = "";
    notesDataCache.sections.forEach((section, sectionIndex) => {
      const sectionEl = document.createElement("section");
      sectionEl.className = "note-section";
      const heading = document.createElement("h3");
      heading.textContent = \`\${sectionIndex + 1}. \${section.name}\`;
      sectionEl.appendChild(heading);
      const ul = document.createElement("ul");
      ul.className = "section-notes-list";

      section.notes.forEach((note, noteIndex) => {
        const li = document.createElement("li");
        const numbering = createNumbering(noteIndex + 1);
        const letterBox = createLetterBox(note.title.slice(0,2));
        const a = document.createElement("a");
        a.href = "#";
        a.textContent = note.title;
        a.tabIndex = 0;
        li.appendChild(numbering);
        li.appendChild(letterBox);
        li.appendChild(a);
        a.addEventListener("click", e => {
          e.preventDefault();
          openDownloadPage(note);
          addRecentActivity(\`Opened note: \${note.title}\`);
        });
        a.addEventListener("keydown", e => {
          if(e.key === "Enter" || e.key === " ") {
            e.preventDefault();
            openDownloadPage(note);
            addRecentActivity(\`Opened note: \${note.title}\`);
          }
        });
        ul.appendChild(li);
      });
      sectionEl.appendChild(ul);
      contentPage.appendChild(sectionEl);
    });
    contentPage.style.display="";
  }

  function openDownloadPage(note) {
    hideAllPages();
    noteTitleElem.textContent = note.title;
    noteDescElem.textContent = note.description || "Tap the button below to download the note.";
    downloadProgressInfo.textContent = "";
    progressBarContainer.style.display = "none";
    progressText.textContent = "0%";
    progressBar.style.width = "0%";
    downloadBtn.disabled = !note.pdfLink || note.pdfLink === "#";
    downloadBtn.removeEventListener("click", downloadBtn._listener);
    downloadBtn._listener = () => startDownloadAnimation(note.pdfLink, note);
    downloadBtn.addEventListener("click", downloadBtn._listener);

    populateExtraMaterials(note);
    populateRelatedTopics(note);
    updateFavoriteBtn(note);

    currentNote = note; // track current note for favorite toggling

    addRecentDownload(note.title);

    downloadPage.style.display = "block";

    renderRecentActivity();
    renderDownloads();
    renderNotifications();
  }

  let currentNote = null;

  favoriteBtn.addEventListener("click", () => {
    if (!currentNote) return;
    toggleFavorite(currentNote);
    updateFavoriteBtn(currentNote);
  });

  favoritesNavBtn.addEventListener("click", e => {
    e.preventDefault();
    hideAllPages();
    showFavorites();
    setActiveTopTab(null);
  });

  function showFavorites() {
    contentPage.innerHTML = "";
    const sectionEl = document.createElement("section");
    sectionEl.className = "note-section";
    const heading = document.createElement("h3");
    heading.textContent = "Favorite Notes";
    sectionEl.appendChild(heading);
    if (favorites.length === 0) {
      const p = document.createElement("p");
      p.textContent = "No favorite notes yet.";
      sectionEl.appendChild(p);
    } else {
      const ul = document.createElement("ul");
      ul.className = "section-notes-list";
      favorites.forEach((note, index) => {
        const li = document.createElement("li");
        const numbering = createNumbering(index + 1);
        const letterBox = createLetterBox(note.title.slice(0,2));
        const a = document.createElement("a");
        a.href = "#";
        a.textContent = note.title;
        a.tabIndex = 0;
        li.appendChild(numbering);
        li.appendChild(letterBox);
        li.appendChild(a);
        a.addEventListener("click", e => {
          e.preventDefault();
          openDownloadPage(note);
          addRecentActivity(\`Opened favorite note: \${note.title}\`);
        });
        ul.appendChild(li);
      });
      sectionEl.appendChild(ul);
    }
    contentPage.appendChild(sectionEl);
    contentPage.style.display = "";
  }

  reportBtn.addEventListener("click", () => {
    alert("Report feature is under development.");
  });

  feedbackBtn.addEventListener("click", () => {
    alert("Feedback feature is under development.");
  });

  function populateExtraMaterials(note) {
    moreMaterialsList.innerHTML = '';
    if(note.extraMaterials && note.extraMaterials.length > 0){
      note.extraMaterials.forEach(item => {
        const li = document.createElement('li');
        const a = document.createElement('a');
        a.href = item.url || '#';
        a.textContent = item.title || 'Additional material';
        a.className = 'extra-link';
        a.target = '_blank';
        li.appendChild(a);
        moreMaterialsList.appendChild(li);
      });
    } else {
      const li = document.createElement('li');
      li.textContent = 'No additional materials available.';
      moreMaterialsList.appendChild(li);
    }
  }

  function populateRelatedTopics(note) {
    relatedTopicsList.innerHTML = '';
    if(note.relatedTopics && note.relatedTopics.length > 0){
      note.relatedTopics.forEach(item => {
        const li = document.createElement('li');
        const a = document.createElement('a');
        a.href = item.url || '#';
        a.textContent = item.title || 'Related topic';
        a.className = 'related-link';
        a.target = '_blank';
        li.appendChild(a);
        relatedTopicsList.appendChild(li);
      });
    } else {
      const li = document.createElement('li');
      li.textContent = 'No related topics available.';
      relatedTopicsList.appendChild(li);
    }
  }

  function startDownloadAnimation(pdfLink, note) {
    if(downloadInterval) clearInterval(downloadInterval);

    const totalSize = 10 * 1024 * 1024; 
    let downloaded = 0;
    const downloadStartTime = performance.now();

    downloadBtn.disabled = true;
    downloadBtn.setAttribute("aria-busy", "true");
    downloadProgressInfo.textContent = "Starting download...";
    progressBarContainer.style.display = "block";

    downloadInterval = setInterval(() => {
      const now = performance.now();
      const elapsed = Math.max((now - downloadStartTime) / 1000, 0.001);

      const randomBytes = (Math.random() * 200 + 100) * 1024 / 4;
      downloaded += randomBytes;
      if(downloaded > totalSize) downloaded = totalSize;

      const percent = (downloaded / totalSize) * 100;
      progressBar.style.width = percent + "%";
      progressText.textContent = percent.toFixed(0) + "%";

      const speedKBs = (downloaded / elapsed / 1024).toFixed(1);
      const remainingBytes = totalSize - downloaded;
      const timeLeft = remainingBytes / (downloaded / elapsed);
      const minutes = Math.floor(timeLeft / 60);
      const seconds = Math.floor(timeLeft % 60);
      const timeStr = \`\${minutes > 0 ? minutes + 'm ' : ''}\${seconds}s\`;

      downloadProgressInfo.textContent = \`Speed: \${speedKBs} KB/s | Time Left: \${timeStr}\`;

      if(percent >= 100){
        clearInterval(downloadInterval);
        downloadBtn.textContent = "Download Complete";
        downloadBtn.setAttribute("aria-busy", "false");
        downloadProgressInfo.textContent = \`Downloaded 10.0 MB in \${elapsed.toFixed(1)} seconds\`;

        setTimeout(() => {
          if(pdfLink !== "#") window.open(pdfLink, "_blank");
          resetDownload();
          showBooksList();
          setActiveTopTab(navHomeLink);
        }, 1300);
      }
    }, 300);
  }

  function resetDownload() {
    if(downloadInterval){
      clearInterval(downloadInterval);
      downloadInterval = null;
    }
    downloadBtn.textContent = "";
    downloadBtn.disabled = false;
    downloadProgressInfo.textContent = "";
    progressBar.style.width = "0%";
    progressText.textContent = "0%";
    progressBarContainer.style.display = "none";
  }

  backBtn.addEventListener("click", e=>{
    e.preventDefault();
    resetDownload();
    downloadPage.style.display = "none";
    showBooksList();
  });

  // Theme toggle with saved preference and checkbox in settings
  function setTheme(dark) {
    if(dark){
      document.body.classList.add("dark-mode");
      themeToggleBtn.innerHTML = '<span class="material-symbols-outlined" aria-hidden="true">dark_mode</span>';
      localStorage.setItem('theme', 'dark');
      if(darkModeToggleCheckbox) darkModeToggleCheckbox.checked = true;
    } else {
      document.body.classList.remove("dark-mode");
      themeToggleBtn.innerHTML = '<span class="material-symbols-outlined" aria-hidden="true">light_mode</span>';
      localStorage.setItem('theme', 'light');
      if(darkModeToggleCheckbox) darkModeToggleCheckbox.checked = false;
    }
  }
  themeToggleBtn.addEventListener("click", () => {
    const isDark = document.body.classList.contains("dark-mode");
    setTheme(!isDark);
    addNotification(`Theme changed to ${!isDark ? 'Dark' : 'Light'} mode`);
  });
  if(darkModeToggleCheckbox){
    darkModeToggleCheckbox.addEventListener("change", e => {
      setTheme(e.target.checked);
      addNotification(`Theme changed to ${e.target.checked ? 'Dark' : 'Light'} mode`);
    });
  }
  const savedTheme = localStorage.getItem('theme');
  if(savedTheme === 'dark'){
    setTheme(true);
  } else if(savedTheme === 'light'){
    setTheme(false);
  } else {
    const prefersDark = window.matchMedia("(prefers-color-scheme: dark)").matches;
    setTheme(prefersDark);
  }

  // Font size setting
  if(fontSizeSelect){
    fontSizeSelect.addEventListener("change", e => {
      const size = e.target.value;
      document.documentElement.style.fontSize =
        size === "small" ? "14px" :
        size === "large" ? "18px" : "16px";
      addNotification(`Font size changed to ${size}`);
      localStorage.setItem('fontSize', size);
    });
    // Init font size from localStorage or default medium
    const savedFontSize = localStorage.getItem('fontSize') || "medium";
    fontSizeSelect.value = savedFontSize;
    document.documentElement.style.fontSize =
      savedFontSize === "small" ? "14px" :
      savedFontSize === "large" ? "18px" : "16px";
  }

  // Sample example setting listener that records notification
  if(exampleSettingCheckbox){
    exampleSettingCheckbox.addEventListener("change", e => {
      addNotification(`Sample setting ${e.target.checked ? 'enabled' : 'disabled'}`);
    });
  }

  // Logo click resets to home
  const logoContainer = document.querySelector(".logo-container");
  logoContainer.addEventListener("click", () => {
    setActiveTopTab(navHomeLink);
    showBooksList();
    addRecentActivity("Returned to Home page");
  });
  logoContainer.addEventListener("keydown", e => {
    if(e.key === "Enter" || e.key === " ") {
      e.preventDefault();
      logoContainer.click();
    }
  });

  // Icons toggle button on mobile
  iconsToggleBtn.addEventListener("click", () => {
    bottomIcons.classList.toggle("show");
  });

  // Clear Info button
  clearInfoBtn.addEventListener("click", () => {
    if(confirm("Are you sure you want to clear recent activity, downloads, and notifications?")) {
      recentActivity = [];
      recentDownloads = [];
      notifications = [];
      localStorage.removeItem('recentActivity');
      localStorage.removeItem('recentDownloads');
      localStorage.removeItem('notifications');
      renderRecentActivity();
      renderDownloads();
      renderNotifications();
      alert("All recent activity, downloads, and notifications have been cleared.");
    }
  });

  // Navigation handlers
  navHomeLink.addEventListener("click", e => { e.preventDefault(); setActiveTopTab(navHomeLink); showBooksList(); });
  navNotesLink.addEventListener("click", e => { e.preventDefault(); setActiveTopTab(navNotesLink); showAllNotes(); });
  navDownloadLink.addEventListener("click", e => { e.preventDefault(); setActiveTopTab(navDownloadLink); showDownloadHistory(); });
  navSettingsLink.addEventListener("click", e => { e.preventDefault(); setActiveTopTab(navSettingsLink); hideAllPages(); settingsPage.style.display = "block"; });
  navInfoLink.addEventListener("click", e => { e.preventDefault(); setActiveTopTab(navInfoLink); hideAllPages(); infoPage.style.display = "block"; renderRecentActivity(); renderDownloads(); renderNotifications(); });

  function setActiveTopTab(activeLink){
    topNavLinks.forEach(link=>{
      if(link === activeLink){
        link.classList.add("active");
        link.setAttribute("aria-current", "page");
      } else {
        link.classList.remove("active");
        link.removeAttribute("aria-current");
      }
    });
  }

  function showDownloadHistory(){
    hideAllPages();
    contentPage.innerHTML = "";
    const section = document.createElement("section");
    section.className = "note-section";
    const heading = document.createElement("h3");
    heading.textContent = "Downloaded Notes";
    section.appendChild(heading);

    const ul = document.createElement("ul");
    ul.className = "section-notes-list";

    const history = JSON.parse(localStorage.getItem("downloadedNotes") || "[]");
    if(history.length === 0){
      const li = document.createElement("li");
      li.textContent = "No downloaded notes yet.";
      ul.appendChild(li);
    } else {
      history.forEach((note, index) => {
        const li = document.createElement("li");
        const numbering = createNumbering(index + 1);
        const letterBox = createLetterBox(note.title.slice(0,2));
        const a = document.createElement("a");
        a.href = "#";
        a.textContent = note.title;
        a.tabIndex = 0;
        li.appendChild(numbering);
        li.appendChild(letterBox);
        li.appendChild(a);
        a.addEventListener("click", e => {
          e.preventDefault();
          openDownloadPage(note);
          addRecentActivity(\`Opened downloaded note: \${note.title}\`);
        });
        ul.appendChild(li);
      });
    }
    section.appendChild(ul);
    contentPage.appendChild(section);
    contentPage.style.display = "";
  }

  // Initial call
  (function init() {
    showBooksList();
    renderRecentActivity();
    renderDownloads();
    renderNotifications();
  })();
});
</script>
</body>
</html>
